---
system:
  get-uptime:
    command: "uptime"
  view-auth-log:
    command: "cat {{ log }}"
    args:
      - log:
          mandatory: True
          from_command: "find /var/log -name '*auth.log*' | grep -v '.gz'"
  tail-log:
    command: "tail {{ log_file }}"
    args:
      - num_lines:
         arg_string: -n {{ num_lines }}
      - log_file:
          mandatory: True
          values:
            - /var/log/messages
            - /var/log/kern.log
            - /var/log/auth.log
apache:
  get-ips:
    command: "tail /var/log/apache2/access_log"
    args:
      - num_lines:
          arg_string: -n {{ num_lines }}
nginx:
  reload:
    command: 'sudo kill -HUP $(sudo pidof nginx)'
  get-top-5-ips:
    command: "sudo cat {{ log_file }} 2>/dev/null | cut -f 1 -d ' ' | sort | uniq -c | sort -hr | head -n 5"
    args:
      - log_file:
          mandatory: True
          from_command: "sudo find /var/log/nginx -name '*access.log*' | grep -v '.gz'"
  get-top-5-response-codes:
    command: "sudo grep -o 'HTTP/.*' /var/log/nginx/access.log 2>/dev/null | cut -f 2 -d ' ' | sort | uniq -c | sort -hr | head -n 5"
performance:
  get-basic-info:
    command: "uptime && echo && free -h && echo && df -h"

